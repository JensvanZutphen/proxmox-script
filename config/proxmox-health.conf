#!/bin/bash
# Proxmox Health Monitoring Configuration
# This file contains all configurable variables for the monitoring system

# --- Webhook Configuration ---
WEBHOOK_URL=""
WEBHOOK_SECRET_FILE="/etc/proxmox-health/webhook-secret"

# --- Directory Configuration ---
CONFIG_DIR="/etc/proxmox-health"
STATE_DIR="/var/tmp/proxmox-health"
LOG_DIR="/var/log/proxmox-health"
BACKUP_DIR="/var/lib/vz/dump"
VZDUMP_LOG_DIR="/var/log/vzdump"

# --- Threshold Configuration ---
# Memory thresholds (percentage)
MEMORY_WARNING_THRESHOLD=90
MEMORY_CRITICAL_THRESHOLD=95

# Swap thresholds (percentage)
SWAP_WARNING_THRESHOLD=50
SWAP_CRITICAL_THRESHOLD=80

# Disk usage thresholds (percentage)
DISK_ROOT_WARNING_THRESHOLD=90
DISK_ROOT_CRITICAL_THRESHOLD=95

# ZFS pool capacity thresholds (percentage)
ZFS_CAPACITY_WARNING_THRESHOLD=80
ZFS_CAPACITY_CRITICAL_THRESHOLD=90

# Load average thresholds
LOAD_AUTO_DETECT="yes"
LOAD_WARNING_THRESHOLD=0
LOAD_CRITICAL_THRESHOLD=0

# I/O wait thresholds (percentage)
IOWAIT_WARNING_THRESHOLD=20
IOWAIT_CRITICAL_THRESHOLD=40

# Network thresholds
PACKET_LOSS_WARNING_THRESHOLD=5
PACKET_LOSS_CRITICAL_THRESHOLD=10
PING_TEST_HOST="1.1.1.1"

# Interface error delta threshold
INTERFACE_ERROR_DELTA_THRESHOLD=50

# SSH security thresholds
SSH_FAILED_LOGIN_THRESHOLD=50
SSH_CONNECTION_WARNING_THRESHOLD=50

# Temperature thresholds (Celsius)
CPU_TEMPERATURE_WARNING_THRESHOLD=85
CPU_TEMPERATURE_CRITICAL_THRESHOLD=95
HDD_TEMPERATURE_WARNING_THRESHOLD=55
HDD_TEMPERATURE_CRITICAL_THRESHOLD=65
SSD_TEMPERATURE_WARNING_THRESHOLD=70
SSD_TEMPERATURE_CRITICAL_THRESHOLD=80

# Backup monitoring
BACKUP_MAX_AGE_DAYS=7

# Network bridges to monitor
MONITORED_BRIDGES="vmbr0"

# --- Timing Configuration ---
HEALTH_CHECK_INTERVAL_MINUTES=5
APT_CHECK_INTERVAL_HOURS=24
ZFS_SCRUB_DAY_OF_MONTH=1
LOGROTATE_HOUR=1
APT_HOUSEKEEPING_DAY_OF_WEEK=0
APT_HOUSEKEEPING_HOUR=2
APT_HOUSEKEEPING_MINUTE=30
DAILY_SUMMARY_TIME="08:00"  # 24h format HH:MM

# --- Service Configuration ---
PROXMOX_SERVICES="pve-cluster pvedaemon pveproxy"

# --- State Management ---
STATE_RETENTION_DAYS=30

# --- Logging Configuration ---
LOG_LEVEL="INFO"
LOG_MAX_SIZE_MB=10
LOG_ROTATION_COUNT=5

# --- Alert Configuration ---
ALERT_COOLDOWN_MINUTES=30
ALERT_MAX_RETRIES=3
ALERT_RETRY_DELAY_SECONDS=60
NOTIFY_MIN_LEVEL="info"  # one of: info|warning|critical
UPDATES_READONLY="yes"

# --- Maintenance Mode ---
MAINTENANCE_MODE_FILE="$STATE_DIR/maintenance.mode"
MAINTENANCE_SCHEDULE_FILE="$CONFIG_DIR/maintenance.schedule"

# Email notifications removed; only Discord webhooks are supported.

# --- Custom Check Directories ---
CUSTOM_CHECKS_DIR="$CONFIG_DIR/custom-checks"
PLUGIN_DIR="$CONFIG_DIR/plugins"

# --- Performance Tuning ---
PARALLEL_CHECKS="yes"
MAX_PARALLEL_PROCESSES=4
CACHE_ENABLED="yes"
CACHE_TTL_MINUTES=15

# --- Quiet Hours ---
QUIET_HOURS_ENABLED="no"
QUIET_HOURS_START="22:00"  # 24h format
QUIET_HOURS_END="07:00"

# --- Check Enable/Disable (per category) ---
# Set to 'yes' to run the check in cron, 'no' to skip
ENABLE_CHECK_SERVICES=yes
ENABLE_CHECK_DISK=yes
ENABLE_CHECK_ZFS=yes
ENABLE_CHECK_MEMORY=yes
ENABLE_CHECK_LOAD=yes
ENABLE_CHECK_IOWAIT=yes
ENABLE_CHECK_NETWORK=yes
ENABLE_CHECK_INTERFACE_ERRORS=yes
ENABLE_CHECK_SSH=yes
ENABLE_CHECK_SYSTEM_EVENTS=yes
ENABLE_CHECK_TEMPS=yes
ENABLE_CHECK_BACKUPS=yes
ENABLE_CHECK_UPDATES=yes
ENABLE_CHECK_VMS=yes

# --- Notification Topics (per category) ---
# Set to 'yes' to send Discord webhook for the topic, 'no' to suppress
NOTIFY_SERVICES=yes
NOTIFY_DISK=yes
NOTIFY_ZFS=yes
NOTIFY_MEMORY=yes
NOTIFY_LOAD=yes
NOTIFY_IOWAIT=yes
NOTIFY_NETWORK=yes
NOTIFY_INTERFACE_ERRORS=yes
NOTIFY_SSH=yes
NOTIFY_SYSTEM_EVENTS=yes
NOTIFY_TEMPS=yes
NOTIFY_BACKUPS=yes
NOTIFY_UPDATES=yes
NOTIFY_VMS=yes
